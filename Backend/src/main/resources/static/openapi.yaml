openapi: 3.1.0
info:
  title: Anteiku API
  description: TODO
  version: 1.0.0

servers:
  - url: http://localhost:8080/api
    description: Local HTTP Development Server

paths:
  /users/register:
    post:
      summary: "Registers a new user"
      operationId: registerUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegistrationDto'
      responses:
        200:
          description: ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRegistrationDto'

  /users/public/{username}:
    get:
      summary: "Get list of users by username"
      operationId: getUsersByUsername
      parameters:
        - name: username
          in: path
          description: "username"
          required: true
          schema:
            type: string
      responses:
        200:
          description: "Successful response returning a list of users"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserPublicDto'

  /users/{id}:
    get:
      summary: "Get user public data by id"
      operationId: getUserById
      parameters:
        - name: id
          in: path
          description: "user id"
          required: true
          schema:
            $ref: '#/components/schemas/UserId'
      responses:
        200:
          description: "Successful! Returns user public data."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPublicDto'
        404:
          description: "GG, user not found :("
  /users/me:
    get:
      summary: "Get information about myself"
      operationId: getMe
      responses:
        200:
          description: "Returns user info"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfoDto'
        401:
          $ref: '#/components/responses/UnauthorizedError'

  /users/check-email:
    get:
      summary: "Check if email is available"
      operationId: checkEmailAvailability
      parameters:
        - name: email
          in: query
          description: "email to check"
          required: true
          schema:
            $ref: '#/components/schemas/UserEmail'
      responses:
        200:
          description: "Returns availability status"
          content:
            application/json:
              schema:
                type: boolean

  /users/check-username:
    get:
      summary: "Check if username is available"
      operationId: checkUsernameAvailability
      parameters:
        - name: username
          in: query
          description: "username to check"
          required: true
          schema:
            type: string
      responses:
        200:
          description: "Returns availability status"
          content:
            application/json:
              schema:
                type: boolean
  /auth/login:
    post:
      summary: "Send authentication request to a server"
      operationId: authenticateUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserAuthDto'
      responses:
        200:
          description: "Returns access token"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserAuthResponseDto'
        401:
          $ref: '#/components/responses/UnauthorizedError'

  /api/info:
    get:
      summary: "Get info"
      description: "Returns some info. Requires ADMIN role."
      operationId: getAppInfo
      security:
        - oauth2: [ ]
      responses:
        200:
          description: "info retrieved successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  app:
                    type: string
                  version:
                    type: string
        401:
          description: "User not authenticated"
        403:
          description: "Forbidden - requires ADMIN role"

  /friends:
    get:
      summary: "Get my friends list"
      operationId: getMyFriends
      security:
        - bearerAuth: [ ]
      responses:
        200:
          description: "List of friends"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FriendDto'

  /friends/{userId}:
      post:
        summary: "Send a friend request"
        operationId: addFriend
        parameters:
          - name: userId
            in: path
            required: true
            schema:
              type: string
              format: uuid
        responses:
          200:
            description: "Request sent"
          400:
            description: "User not found or already friends"

      put:
        summary: "Accept a friend request"
        operationId: acceptFriend
        parameters:
          - name: userId
            in: path
            required: true
            description: "The ID of the person who sent the request"
            schema:
              type: string
              format: uuid
        responses:
          200:
            description: "Friendship accepted"

      delete:
        summary: "Remove friend or cancel request"
        operationId: removeFriend
        parameters:
          - name: userId
            in: path
            required: true
            schema:
              type: string
              format: uuid
        responses:
          200:
            description: "Removed"

components:
  responses:
    UnauthorizedError:
      description: "Access token is missing"

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UserId:
      type: string
      format: uuid
      description: "User's universally unique identifier"

    UserPassword:
      type: string
      format: password

    UserEmail:
      type: string
      format: email

    UserPublicDto:
      type: object
      description: "Public user data"
      properties:
        id:
          $ref: '#/components/schemas/UserId'
        username:
          type: string
        displayName:
          type: string
        picture:
          type: string
        about:
          type: string
        status:
          type: string
          enum: [ONLINE, IDLE, DND, OFFLINE]
        timestamp:
          type: string
          format: date-time
        role:
          type: string

    UserAuthDto:
      type: object
      description: "User authentication data"
      properties:
        email:
          $ref: '#/components/schemas/UserEmail'
        password:
          $ref: '#/components/schemas/UserPassword'

    UserAuthResponseDto:
      type: object
      description: "User and token info"
      properties:
        accessToken:
          type: string
        tokenType:
          type: string
          enum: [bearer]
        refreshToken:
          type: string
        tokenExpiresIn:
          type: integer
          format: int64
        userInfo:
          $ref: '#/components/schemas/UserInfoDto'

    UserInfoDto:
      type: object
      description: "User general account info"
      properties:
        id:
          $ref: '#/components/schemas/UserId'
        email:
          $ref: '#/components/schemas/UserEmail'
        username:
          type: string
        role:
          type: string

    UserCredentialsDto:
      type: object
      description: "User credentials"
      properties:
        userId:
          $ref: '#/components/schemas/UserId'
        email:
          $ref: '#/components/schemas/UserEmail'
        password:
          $ref: '#/components/schemas/UserPassword'

    UserRegistrationDto:
      type: object
      description: "User registration data"
      properties:
        username:
          type: string
        email:
          $ref: '#/components/schemas/UserEmail'
        password:
          $ref: '#/components/schemas/UserPassword'

    FriendDto:
      type: object
      description: "Friend relationship informational data"
      properties:
        id:
          $ref: '#/components/schemas/UserId'
        username:
          type: string
        displayName:
          type: string
        status:
          type: string
          enum: [ONLINE, IDLE, DND, OFFLINE]
        friendStatus:
          type: string
          enum: [FRIEND, PENDING, BLOCKED]
